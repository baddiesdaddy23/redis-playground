<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redis Data Structure Playground</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes snapshot {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }
        @keyframes aofWrite {
            0% { transform: translateY(0); }
            100% { transform: translateY(5px); opacity: 0; }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .pulse-once { animation: pulse 0.5s ease-out; }
        .slide-in { animation: slideIn 0.3s ease-out; }
        .snapshot-flash { animation: snapshot 0.6s ease-out; }
        .aof-line { animation: aofWrite 0.8s ease-out forwards; }
        .spinner { animation: spin 1s linear infinite; }
        
        .list-item {
            transition: all 0.3s ease;
        }
        .hash-row {
            transition: all 0.3s ease;
        }
        .set-node {
            transition: all 0.3s ease;
        }
        .zset-bar {
            transition: all 0.5s ease;
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #1f2937;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }

        /* Autocomplete dropdown */
        .autocomplete-items {
            position: absolute;
            border: 1px solid #4b5563;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 200px;
            overflow-y: auto;
        }
        .autocomplete-items div {
            padding: 10px;
            cursor: pointer;
            background-color: #1f2937;
            border-bottom: 1px solid #4b5563;
        }
        .autocomplete-items div:hover {
            background-color: #374151;
        }
        .autocomplete-active {
            background-color: #dc2626 !important;
            color: white;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .mobile-stack {
                flex-direction: column;
            }
            .mobile-full {
                width: 100%;
            }
            .mobile-text-sm {
                font-size: 0.875rem;
            }
            .mobile-p-2 {
                padding: 0.5rem;
            }
        }

        /* Connection visualization */
        .connection-line {
            stroke-dasharray: 10;
            animation: dash 1s linear infinite;
        }
        @keyframes dash {
            to {
                stroke-dashoffset: -20;
            }
        }

        /* Memory structure */
        .memory-cell {
            transition: all 0.3s ease;
        }
        .memory-cell:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="mb-6">
            <h1 class="text-4xl font-bold text-center mb-2 bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">
                Redis Data Structure Playground
            </h1>
            <p class="text-center text-gray-400">Execute commands and watch data structures come to life</p>
        </div>

        <!-- Memory & Persistence Status Bar -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6 flex flex-wrap gap-4 items-center justify-between mobile-stack">
            <div class="flex items-center gap-6 mobile-stack">
                <div>
                    <div class="text-sm text-gray-400 mb-1">Memory Usage</div>
                    <div class="flex items-center gap-2">
                        <div class="w-48 bg-gray-700 rounded-full h-4 overflow-hidden">
                            <div id="memoryBar" class="bg-gradient-to-r from-green-500 to-yellow-500 h-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <span id="memoryText" class="text-sm font-mono text-green-400">0 KB / 1000 KB</span>
                    </div>
                </div>
                <div>
                    <div class="text-sm text-gray-400 mb-1">Operations/sec</div>
                    <div id="opsCounter" class="text-2xl font-bold text-blue-400">0</div>
                </div>
                <div class="flex gap-2">
                    <button id="exportBtn" class="px-3 py-1 rounded bg-green-600 hover:bg-green-700 text-sm transition-colors">
                        Export Data
                    </button>
                    <button id="importBtn" class="px-3 py-1 rounded bg-blue-600 hover:bg-blue-700 text-sm transition-colors">
                        Import Data
                    </button>
                    <input type="file" id="importFile" class="hidden" accept=".json">
                </div>
            </div>
            
            <div class="flex gap-2">
                <button id="rdbToggle" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors border-2 border-transparent">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-gray-500" id="rdbIndicator"></div>
                        <span>RDB Snapshots</span>
                    </div>
                </button>
                <button id="aofToggle" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors border-2 border-transparent">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-gray-500" id="aofIndicator"></div>
                        <span>AOF</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- Connection Visualization -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6 hidden" id="connectionViz">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <span class="text-purple-500">ðŸ”—</span> Client-Server Connection
            </h2>
            <div class="flex items-center justify-between px-4">
                <div class="text-center">
                    <div class="bg-blue-600 p-3 rounded-lg inline-block">
                        <span class="font-bold">CLIENT</span>
                    </div>
                    <div class="text-xs text-gray-400 mt-2">Your Browser</div>
                </div>
                
                <div class="flex-1 mx-4 relative">
                    <svg width="100%" height="60" class="connection-line">
                        <line x1="0" y1="30" x2="100%" y2="30" stroke="#4b5563" stroke-width="2" />
                        <line x1="0" y1="30" x2="100%" y2="30" stroke="#dc2626" stroke-width="2" class="connection-line" id="requestLine" />
                        <line x1="100%" y1="30" x2="0" y2="30" stroke="#16a34a" stroke-width="2" class="connection-line" id="responseLine" />
                    </svg>
                    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 bg-gray-900 px-3 py-1 rounded text-sm">
                        TCP Connection
                    </div>
                </div>
                
                <div class="text-center">
                    <div class="bg-red-600 p-3 rounded-lg inline-block">
                        <span class="font-bold">REDIS</span>
                    </div>
                    <div class="text-xs text-gray-400 mt-2">In-Memory Store</div>
                </div>
            </div>
            <div class="mt-4 grid grid-cols-2 gap-4 text-xs">
                <div id="requestStatus" class="text-blue-400 text-center">Ready for requests</div>
                <div id="responseStatus" class="text-green-400 text-center">Ready for responses</div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Left Panel: Command Interface -->
            <div class="space-y-4">
                <!-- Command Input -->
                <div class="bg-gray-800 rounded-lg p-4">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <span class="text-red-500">âš¡</span> Command Terminal
                    </h2>
                    <div class="flex gap-2 mb-4 relative">
                        <div class="flex-1 relative">
                            <input 
                                type="text" 
                                id="commandInput" 
                                placeholder="Enter Redis command (e.g., SET key value, LPUSH mylist item)"
                                class="flex-1 bg-gray-900 border border-gray-700 rounded px-4 py-2 focus:outline-none focus:border-red-500 font-mono text-sm mobile-full"
                                autocomplete="off"
                            />
                            <div id="autocompleteList" class="autocomplete-items hidden"></div>
                        </div>
                        <button id="executeBtn" class="px-6 py-2 bg-red-600 hover:bg-red-700 rounded font-semibold transition-colors flex items-center gap-2 mobile-full mobile-p-2">
                            <span>Execute</span>
                            <div id="executeSpinner" class="spinner hidden w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>
                        </button>
                    </div>
                    <div class="flex gap-2 mb-2">
                        <button id="historyPrev" class="px-3 py-1 bg-gray-700 rounded text-sm hover:bg-gray-600 transition-colors" disabled>â†‘ Previous</button>
                        <button id="historyNext" class="px-3 py-1 bg-gray-700 rounded text-sm hover:bg-gray-600 transition-colors" disabled>â†“ Next</button>
                        <div class="flex-1 text-right">
                            <span id="commandCounter" class="text-xs text-gray-500">History: 0 commands</span>
                        </div>
                    </div>
                    <div id="output" class="bg-gray-900 rounded p-3 min-h-[200px] max-h-[400px] overflow-y-auto font-mono text-sm custom-scrollbar">
                        <div class="text-gray-500">redis> Ready for commands...</div>
                    </div>
                </div>

                <!-- Memory Structure Visualization -->
                <div class="bg-gray-800 rounded-lg p-4">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <span class="text-cyan-500">ðŸ§ </span> Memory Structure
                    </h2>
                    <div id="memoryStructure" class="bg-gray-900 rounded p-4 min-h-[100px]">
                        <div class="text-gray-500 text-center py-4">Memory visualization will appear here as you add data</div>
                    </div>
                </div>

                <!-- Quick Scenarios -->
                <div class="bg-gray-800 rounded-lg p-4">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <span class="text-yellow-500">ðŸŽ®</span> Quick Scenarios
                    </h2>
                    <div class="grid grid-cols-2 gap-2">
                        <button class="scenario-btn px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded transition-colors text-left" data-commands='["LPUSH inventory Sword", "LPUSH inventory Shield", "LPUSH inventory Potion"]'>
                            <div class="font-semibold text-sm">Add to Inventory</div>
                            <div class="text-xs text-gray-400">LPUSH operations</div>
                        </button>
                        <button class="scenario-btn px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded transition-colors text-left" data-commands='["SADD tags:player1 warrior", "SADD tags:player1 veteran", "SADD tags:player1 guild-leader"]'>
                            <div class="font-semibold text-sm">Tag Player</div>
                            <div class="text-xs text-gray-400">SADD operations</div>
                        </button>
                        <button class="scenario-btn px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded transition-colors text-left" data-commands='["HSET character:1 name Aragorn", "HSET character:1 health 100", "HSET character:1 level 45", "HSET character:1 class Ranger"]'>
                            <div class="font-semibold text-sm">Character Stats</div>
                            <div class="text-xs text-gray-400">HSET operations</div>
                        </button>
                        <button class="scenario-btn px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded transition-colors text-left" data-commands='["ZADD leaderboard 1500 Alice", "ZADD leaderboard 2300 Bob", "ZADD leaderboard 1800 Charlie", "ZADD leaderboard 2100 Diana"]'>
                            <div class="font-semibold text-sm">Leaderboard</div>
                            <div class="text-xs text-gray-400">ZADD operations</div>
                        </button>
                        <button class="scenario-btn px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded transition-colors text-left" data-commands='["SET session:abc123 user_id_42", "EXPIRE session:abc123 30"]'>
                            <div class="font-semibold text-sm">Session Cache</div>
                            <div class="text-xs text-gray-400">SET with TTL</div>
                        </button>
                        <button class="scenario-btn px-4 py-3 bg-gray-700 hover:bg-gray-600 rounded transition-colors text-left" data-commands='["RPUSH queue:tasks process-payment", "RPUSH queue:tasks send-email", "RPUSH queue:tasks update-inventory"]'>
                            <div class="font-semibold text-sm">Task Queue</div>
                            <div class="text-xs text-gray-400">RPUSH operations</div>
                        </button>
                    </div>
                </div>

                <!-- Command Reference -->
                <div class="bg-gray-800 rounded-lg p-4">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <span class="text-blue-500">ðŸ“š</span> Quick Reference
                    </h2>
                    <div class="space-y-2 text-sm">
                        <!-- ... (existing command reference content remains the same) ... -->
                        <div class="text-xs uppercase tracking-wider text-gray-400 mt-1">Strings</div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">SET key value</span><span class="text-gray-400"> - Create/update a string</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">MSET key value [key value ...]</span><span class="text-gray-400"> - Set multiple</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">GET key</span><span class="text-gray-400"> - Read a string</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">MGET key [key ...]</span><span class="text-gray-400"> - Read multiple</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">DEL key [key ...]</span><span class="text-gray-400"> - Delete keys</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">EXPIRE key seconds</span><span class="text-gray-400"> - Set TTL</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">TTL key</span><span class="text-gray-400"> - Get TTL</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">RENAME oldkey newkey</span><span class="text-gray-400"> - Rename key</span></div>
                        <div class="bg-gray-900 rounded p-2 mb-2"><span class="text-green-400 font-mono">KEYS pattern</span><span class="text-gray-400"> - Find keys</span></div>

                        <div class="text-xs uppercase tracking-wider text-gray-400 mt-3">Lists</div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">LPUSH key value [value ...]</span><span class="text-gray-400"> - Push left</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">RPUSH key value [value ...]</span><span class="text-gray-400"> - Push right</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">LPOP key</span><span class="text-gray-400"> - Pop left</span></div>
                        <div class="bg-gray-900 rounded p-2 mb-2"><span class="text-green-400 font-mono">RPOP key</span><span class="text-gray-400"> - Pop right</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">LRANGE key start stop</span><span class="text-gray-400"> - Range by index</span></div>

                        <div class="text-xs uppercase tracking-wider text-gray-400 mt-3">Sets</div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">SADD key member [member ...]</span><span class="text-gray-400"> - Add members</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">SREM key member [member ...]</span><span class="text-gray-400"> - Remove members</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">SISMEMBER key member</span><span class="text-gray-400"> - Check membership</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">SCARD key</span><span class="text-gray-400"> - Set size</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">SMEMBERS key</span><span class="text-gray-400"> - List members</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">SINTER key [key ...]</span><span class="text-gray-400"> - Intersection</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">SUNION key [key ...]</span><span class="text-gray-400"> - Union</span></div>
                        <div class="bg-gray-900 rounded p-2 mb-2"><span class="text-green-400 font-mono">SDIFF key [key ...]</span><span class="text-gray-400"> - Difference</span></div>

                        <div class="text-xs uppercase tracking-wider text-gray-400 mt-3">Hashes</div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HSET key field value [field value ...]</span><span class="text-gray-400"> - Set fields</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HMSET key field value [field value ...]</span><span class="text-gray-400"> - Set multiple (deprecated)</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HGET key field</span><span class="text-gray-400"> - Get field</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HMGET key field [field ...]</span><span class="text-gray-400"> - Get multiple fields</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HGETALL key</span><span class="text-gray-400"> - All fields/values</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HDEL key field [field ...]</span><span class="text-gray-400"> - Delete fields</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HEXISTS key field</span><span class="text-gray-400"> - Field exists</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HLEN key</span><span class="text-gray-400"> - Field count</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HKEYS key</span><span class="text-gray-400"> - Field names</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HVALS key</span><span class="text-gray-400"> - Field values</span></div>
                        <div class="bg-gray-900 rounded p-2 mb-2"><span class="text-green-400 font-mono">HINCRBY / HINCRBYFLOAT</span><span class="text-gray-400"> - Increment field</span></div>

                        <div class="text-xs uppercase tracking-wider text-gray-400 mt-3">Sorted Sets</div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">ZADD key score member [score member ...]</span><span class="text-gray-400"> - Add/update members</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">ZRANGE key start stop [WITHSCORES]</span><span class="text-gray-400"> - Range by index</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">ZRANGEBYSCORE key min max [WITHSCORES]</span><span class="text-gray-400"> - Range by score</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">ZREM key member [member ...]</span><span class="text-gray-400"> - Remove members</span></div>
                        <div class="bg-gray-900 rounded p-2 mb-2"><span class="text-green-400 font-mono">ZCARD key</span><span class="text-gray-400"> - Member count</span></div>

                        <div class="text-xs uppercase tracking-wider text-gray-400 mt-3">Other</div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">FLUSHALL</span><span class="text-gray-400"> - Remove all keys</span></div>
                        <div class="bg-gray-900 rounded p-2"><span class="text-green-400 font-mono">HELP</span><span class="text-gray-400"> - Show this list</span></div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Visualizations -->
            <div class="space-y-4">
                <!-- Data Structure Tabs -->
                <div class="bg-gray-800 rounded-lg p-4">
                    <div class="flex gap-2 mb-4 flex-wrap">
                        <button class="tab-btn px-4 py-2 rounded bg-red-600 text-white font-semibold" data-type="string">Strings</button>
                        <button class="tab-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600" data-type="list">Lists</button>
                        <button class="tab-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600" data-type="set">Sets</button>
                        <button class="tab-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600" data-type="hash">Hashes</button>
                        <button class="tab-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600" data-type="zset">Sorted Sets</button>
                        <button class="tab-btn px-4 py-2 rounded bg-gray-700 hover:bg-gray-600" data-type="pubsub">Pub/Sub</button>
                    </div>

                    <!-- Visualization Area -->
                    <div id="visualizationArea" class="min-h-[500px] bg-gray-900 rounded-lg p-6">
                        <!-- String Visualization -->
                        <div id="stringViz" class="visualization-panel">
                            <h3 class="text-lg font-bold mb-4 text-red-400">String Key-Value Pairs</h3>
                            <div id="stringContainer" class="space-y-2">
                                <div class="text-gray-500 text-center py-8">No string keys yet. Try: SET mykey myvalue</div>
                            </div>
                        </div>

                        <!-- List Visualization -->
                        <div id="listViz" class="visualization-panel hidden">
                            <h3 class="text-lg font-bold mb-4 text-blue-400">Lists (Stacks/Queues)</h3>
                            <div id="listContainer" class="space-y-4">
                                <div class="text-gray-500 text-center py-8">No lists yet. Try: LPUSH mylist item1</div>
                            </div>
                        </div>

                        <!-- Set Visualization -->
                        <div id="setViz" class="visualization-panel hidden">
                            <h3 class="text-lg font-bold mb-4 text-green-400">Sets (Unique Members)</h3>
                            <div id="setContainer" class="space-y-4">
                                <div class="text-gray-500 text-center py-8">No sets yet. Try: SADD myset member1</div>
                            </div>
                        </div>

                        <!-- Hash Visualization -->
                        <div id="hashViz" class="visualization-panel hidden">
                            <h3 class="text-lg font-bold mb-4 text-purple-400">Hashes (Field-Value Maps)</h3>
                            <div id="hashContainer" class="space-y-4">
                                <div class="text-gray-500 text-center py-8">No hashes yet. Try: HSET myhash field1 value1</div>
                            </div>
                        </div>

                        <!-- Sorted Set Visualization -->
                        <div id="zsetViz" class="visualization-panel hidden">
                            <h3 class="text-lg font-bold mb-4 text-yellow-400">Sorted Sets (Ranked Members)</h3>
                            <div id="zsetContainer" class="space-y-4">
                                <div class="text-gray-500 text-center py-8">No sorted sets yet. Try: ZADD myzset 100 member1</div>
                            </div>
                        </div>

                        <!-- Pub/Sub Visualization -->
                        <div id="pubsubViz" class="visualization-panel hidden">
                            <h3 class="text-lg font-bold mb-4 text-pink-400">Pub/Sub Messaging</h3>
                            <div class="space-y-4">
                                <div class="bg-gray-800 rounded-lg p-4">
                                    <h4 class="font-bold mb-2">Channels</h4>
                                    <div id="channelsList" class="space-y-2">
                                        <div class="text-gray-500 text-center py-4">No active channels. Use SUBSCRIBE to create channels</div>
                                    </div>
                                </div>
                                <div class="bg-gray-800 rounded-lg p-4">
                                    <h4 class="font-bold mb-2">Publish Message</h4>
                                    <div class="flex gap-2">
                                        <input type="text" id="pubChannel" placeholder="Channel name" class="flex-1 bg-gray-700 rounded px-3 py-2 text-sm">
                                        <input type="text" id="pubMessage" placeholder="Message" class="flex-1 bg-gray-700 rounded px-3 py-2 text-sm">
                                        <button id="publishBtn" class="px-4 py-2 bg-pink-600 hover:bg-pink-700 rounded text-sm">Publish</button>
                                    </div>
                                </div>
                                <div class="bg-gray-800 rounded-lg p-4">
                                    <h4 class="font-bold mb-2">Message Log</h4>
                                    <div id="messageLog" class="bg-gray-900 rounded p-3 h-32 overflow-y-auto text-sm">
                                        <div class="text-gray-500">No messages yet</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Persistence Visualization -->
                <div class="bg-gray-800 rounded-lg p-4">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <span class="text-orange-500">ðŸ’¾</span> Persistence Layer
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <!-- RDB Panel -->
                        <div class="bg-gray-900 rounded p-3">
                            <div class="text-sm font-semibold mb-2 text-orange-400">RDB Snapshots</div>
                            <div id="rdbStatus" class="text-xs text-gray-500 mb-2">Disabled</div>
                            <div id="rdbVisual" class="space-y-1 min-h-[80px]">
                            </div>
                        </div>
                        <!-- AOF Panel -->
                        <div class="bg-gray-900 rounded p-3">
                            <div class="text-sm font-semibold mb-2 text-blue-400">AOF Log</div>
                            <div id="aofStatus" class="text-xs text-gray-500 mb-2">Disabled</div>
                            <div id="aofVisual" class="font-mono text-xs space-y-1 max-h-[80px] overflow-hidden">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Redis Data Store
        const redisStore = {
            strings: {},
            lists: {},
            sets: {},
            hashes: {},
            zsets: {},
            pubsub: {} // New: Pub/Sub channels
        };
        const ttlStore = {};
        const pubSubStore = {
            channels: {},
            subscribers: {}
        };

        // State
        let currentTab = 'string';
        let rdbEnabled = false;
        let aofEnabled = false;
        let memoryUsed = 0;
        let operationCount = 0;
        let lastOpTime = Date.now();
        let commandHistory = [];
        let historyIndex = -1;
        let isProcessing = false;

        // Enhanced Command specs with categories for autocomplete
        const COMMAND_SPECS = {
            // ... (existing command specs remain the same) ...
            // String commands
            SET: {
                purpose: 'Set key to a string value (overwrites existing and clears TTL).',
                formats: ['SET key value'],
                examples: ['SET name "Mario"', 'SET user:1001 "John Doe"'],
                category: 'string'
            },
            MSET: {
                purpose: 'Set multiple string key/value pairs.',
                formats: ['MSET key value [key value ...]'],
                examples: ['MSET name "Mario" color red skill 10'],
                category: 'string'
            },
            GET: {
                purpose: 'Get the string value stored at key.',
                formats: ['GET key'],
                examples: ['GET name'],
                category: 'string'
            },
            MGET: {
                purpose: 'Get the string values of multiple keys.',
                formats: ['MGET key [key ...]'],
                examples: ['MGET name color skill'],
                category: 'string'
            },
            DEL: {
                purpose: 'Delete one or more keys, ignoring missing keys.',
                formats: ['DEL key [key ...]'],
                examples: ['DEL user:1001'],
                category: 'key'
            },
            // List commands
            LPUSH: {
                purpose: 'Insert one or more elements at the head (left) of a list.',
                formats: ['LPUSH key value [value ...]'],
                examples: ['LPUSH fruits "apple" "banana" "cherry"'],
                category: 'list'
            },
            RPUSH: {
                purpose: 'Insert one or more elements at the tail (right) of a list.',
                formats: ['RPUSH key value [value ...]'],
                examples: ['RPUSH fruits "orange" "grape"'],
                category: 'list'
            },
            LPOP: {
                purpose: 'Remove and return the first element of a list (left).',
                formats: ['LPOP key'],
                examples: ['LPOP fruits'],
                category: 'list'
            },
            RPOP: {
                purpose: 'Remove and return the last element of a list (right).',
                formats: ['RPOP key'],
                examples: ['RPOP fruits'],
                category: 'list'
            },
            LRANGE: {
                purpose: 'Get a range of elements from a list by index.',
                formats: ['LRANGE key start stop'],
                examples: ['LRANGE fruits 0 2'],
                category: 'list'
            },
            // Set commands
            SADD: {
                purpose: 'Add one or more unique members to a set.',
                formats: ['SADD key member [member ...]'],
                examples: ['SADD fruit "apple" "banana" "cherry"'],
                category: 'set'
            },
            SREM: {
                purpose: 'Remove one or more members from a set.',
                formats: ['SREM key member [member ...]'],
                examples: ['SREM myset "banana"'],
                category: 'set'
            },
            SISMEMBER: {
                purpose: 'Check if a member exists in a set (1 or 0).',
                formats: ['SISMEMBER key member'],
                examples: ['SISMEMBER myset "apple"'],
                category: 'set'
            },
            SINTER: {
                purpose: 'Return the intersection of one or more sets.',
                formats: ['SINTER key [key ...]'],
                examples: ['SINTER set1 set2'],
                category: 'set'
            },
            SUNION: {
                purpose: 'Return the union of one or more sets.',
                formats: ['SUNION key [key ...]'],
                examples: ['SUNION set1 set2'],
                category: 'set'
            },
            SDIFF: {
                purpose: 'Return the difference of sets (elements in the first not in others).',
                formats: ['SDIFF key [key ...]'],
                examples: ['SDIFF set1 set2'],
                category: 'set'
            },
            SCARD: {
                purpose: 'Return the cardinality (number of members) in a set.',
                formats: ['SCARD key'],
                examples: ['SCARD myset'],
                category: 'set'
            },
            SMEMBERS: {
                purpose: 'Return all members of a set.',
                formats: ['SMEMBERS key'],
                examples: ['SMEMBERS myset'],
                category: 'set'
            },
            // Hash commands
            HSET: {
                purpose: 'Set one or more field/value pairs in a hash (create/update).',
                formats: ['HSET key field value [field value ...]'],
                examples: ['HSET user:1001 name "Alice" age "25" email "alice@example.com"'],
                category: 'hash'
            },
            HGET: {
                purpose: 'Retrieve the value of a specific field from a hash.',
                formats: ['HGET key field'],
                examples: ['HGET user:1000 name'],
                category: 'hash'
            },
            HMSET: {
                purpose: 'Set multiple fields in a hash (deprecated in modern Redis; use HSET).',
                formats: ['HMSET key field value [field value ...]'],
                examples: ['HMSET user:1000 name "John" age 30 email "john@example.com"'],
                category: 'hash'
            },
            HMGET: {
                purpose: 'Get the values of multiple fields from a hash.',
                formats: ['HMGET key field [field ...]'],
                examples: ['HMGET user:1000 name age'],
                category: 'hash'
            },
            HGETALL: {
                purpose: 'Get all fields and values in a hash.',
                formats: ['HGETALL key'],
                examples: ['HGETALL user:1000'],
                category: 'hash'
            },
            HDEL: {
                purpose: 'Delete one or more fields from a hash.',
                formats: ['HDEL key field [field ...]'],
                examples: ['HDEL user:1001 name age'],
                category: 'hash'
            },
            HEXISTS: {
                purpose: 'Check if a field exists in a hash (1 or 0).',
                formats: ['HEXISTS key field'],
                examples: ['HEXISTS user:1000 age'],
                category: 'hash'
            },
            HLEN: {
                purpose: 'Get the number of fields in a hash.',
                formats: ['HLEN key'],
                examples: ['HLEN user:1000'],
                category: 'hash'
            },
            HKEYS: {
                purpose: 'Get all field names in a hash.',
                formats: ['HKEYS key'],
                examples: ['HKEYS user:1000'],
                category: 'hash'
            },
            HVALS: {
                purpose: 'Get all values in a hash.',
                formats: ['HVALS key'],
                examples: ['HVALS user:1000'],
                category: 'hash'
            },
            HINCRBY: {
                purpose: 'Increment a hash field by an integer.',
                formats: ['HINCRBY key field increment'],
                examples: ['HINCRBY user:1000 age 1'],
                category: 'hash'
            },
            HINCRBYFLOAT: {
                purpose: 'Increment a hash field by a floating point number.',
                formats: ['HINCRBYFLOAT key field increment'],
                examples: ['HINCRBYFLOAT user:1000 balance 10.5'],
                category: 'hash'
            },
            // Sorted set commands
            ZADD: {
                purpose: 'Add or update sorted set members with scores.',
                formats: ['ZADD key score member [score member ...]'],
                examples: ['ZADD fruit_popularity 100 "banana" 150 "apple" 50 "cherry"'],
                category: 'zset'
            },
            ZRANGE: {
                purpose: 'Return a range of sorted set members by index.',
                formats: ['ZRANGE key start stop [WITHSCORES]'],
                examples: ['ZRANGE fruit_popularity 0 1 WITHSCORES'],
                category: 'zset'
            },
            ZRANGEBYSCORE: {
                purpose: 'Return sorted set members within a score range.',
                formats: ['ZRANGEBYSCORE key min max [WITHSCORES]'],
                examples: ['ZRANGEBYSCORE fruit_popularity 50 150 WITHSCORES'],
                category: 'zset'
            },
            ZREM: {
                purpose: 'Remove one or more members from a sorted set.',
                formats: ['ZREM key member [member ...]'],
                examples: ['ZREM fruit_popularity "cherry"'],
                category: 'zset'
            },
            ZCARD: {
                purpose: 'Return the number of elements in a sorted set.',
                formats: ['ZCARD key'],
                examples: ['ZCARD fruit_popularity'],
                category: 'zset'
            },
            // Key management
            EXPIRE: {
                purpose: 'Set a timeout on a key in seconds.',
                formats: ['EXPIRE key seconds'],
                examples: ['EXPIRE fruit_stock 3600'],
                category: 'key'
            },
            TTL: {
                purpose: 'Get the time-to-live for a key.',
                formats: ['TTL key'],
                examples: ['TTL fruit_stock'],
                category: 'key'
            },
            RENAME: {
                purpose: 'Rename a key to a new name (overwrites destination).',
                formats: ['RENAME oldkey newkey'],
                examples: ['RENAME fruit_prices fresh_fruit_prices'],
                category: 'key'
            },
            KEYS: {
                purpose: 'Find keys matching a pattern (use with caution).',
                formats: ['KEYS pattern'],
                examples: ['KEYS fruit:*'],
                category: 'key'
            },
            // Pub/Sub commands
            SUBSCRIBE: {
                purpose: 'Subscribe to one or more channels.',
                formats: ['SUBSCRIBE channel [channel ...]'],
                examples: ['SUBSCRIBE news sports'],
                category: 'pubsub'
            },
            PUBLISH: {
                purpose: 'Publish a message to a channel.',
                formats: ['PUBLISH channel message'],
                examples: ['PUBLISH news "Hello World!"'],
                category: 'pubsub'
            },
            UNSUBSCRIBE: {
                purpose: 'Unsubscribe from one or more channels.',
                formats: ['UNSUBSCRIBE [channel ...]'],
                examples: ['UNSUBSCRIBE news'],
                category: 'pubsub'
            },
            HELP: {
                purpose: 'Show overview of available commands.',
                formats: ['HELP'],
                examples: [],
                category: 'system'
            },
            FLUSHALL: {
                purpose: 'Remove all keys from the database.',
                formats: ['FLUSHALL'],
                examples: [],
                category: 'system'
            }
        };

        // Memory calculation (approximate)
        function calculateMemory() {
            let total = 0;
            
            // Strings: key + value
            Object.entries(redisStore.strings).forEach(([k, v]) => {
                total += k.length + String(v).length;
            });
            
            // Lists
            Object.entries(redisStore.lists).forEach(([k, v]) => {
                total += k.length + v.reduce((sum, item) => sum + String(item).length, 0);
            });
            
            // Sets
            Object.entries(redisStore.sets).forEach(([k, v]) => {
                total += k.length + Array.from(v).reduce((sum, item) => sum + String(item).length, 0);
            });
            
            // Hashes
            Object.entries(redisStore.hashes).forEach(([k, v]) => {
                total += k.length;
                Object.entries(v).forEach(([field, val]) => {
                    total += field.length + String(val).length;
                });
            });
            
            // Sorted Sets
            Object.entries(redisStore.zsets).forEach(([k, v]) => {
                total += k.length + v.reduce((sum, item) => sum + String(item.member).length + 8, 0);
            });
            
            return total;
        }

        function updateMemoryDisplay() {
            memoryUsed = calculateMemory();
            const maxMemory = 1000 * 1024; // 1000 KB
            const percentage = Math.min((memoryUsed / maxMemory) * 100, 100);
            
            document.getElementById('memoryBar').style.width = percentage + '%';
            document.getElementById('memoryText').textContent = 
                `${(memoryUsed / 1024).toFixed(2)} KB / ${(maxMemory / 1024).toFixed(0)} KB`;
            
            // Change color based on usage
            const bar = document.getElementById('memoryBar');
            if (percentage > 80) {
                bar.className = 'bg-gradient-to-r from-red-500 to-red-600 h-full transition-all duration-500';
            } else if (percentage > 50) {
                bar.className = 'bg-gradient-to-r from-yellow-500 to-orange-500 h-full transition-all duration-500';
            } else {
                bar.className = 'bg-gradient-to-r from-green-500 to-yellow-500 h-full transition-all duration-500';
            }
        }

        function updateOpsCounter() {
            operationCount++;
            const now = Date.now();
            const elapsed = (now - lastOpTime) / 1000;
            const opsPerSec = elapsed > 0 ? Math.round(1 / elapsed) : 0;
            document.getElementById('opsCounter').textContent = opsPerSec;
            lastOpTime = now;
            
            // Reset after 2 seconds
            setTimeout(() => {
                document.getElementById('opsCounter').textContent = '0';
            }, 2000);
        }

        // Enhanced functions with new features
        function showConnectionAnimation() {
            const connectionViz = document.getElementById('connectionViz');
            const requestLine = document.getElementById('requestLine');
            const responseLine = document.getElementById('responseLine');
            const requestStatus = document.getElementById('requestStatus');
            const responseStatus = document.getElementById('responseStatus');
            
            connectionViz.classList.remove('hidden');
            
            // Animate request
            requestStatus.textContent = 'Sending command...';
            requestLine.style.opacity = '1';
            
            setTimeout(() => {
                requestStatus.textContent = 'Command received';
                requestLine.style.opacity = '0.3';
                
                // Animate response
                responseStatus.textContent = 'Sending response...';
                responseLine.style.opacity = '1';
                
                setTimeout(() => {
                    responseStatus.textContent = 'Response received';
                    responseLine.style.opacity = '0.3';
                }, 500);
            }, 800);
        }

        function renderMemoryStructure() {
            const container = document.getElementById('memoryStructure');
            const totalKeys = getAllKeys().length;
            
            if (totalKeys === 0) {
                container.innerHTML = '<div class="text-gray-500 text-center py-4">Memory visualization will appear here as you add data</div>';
                return;
            }
            
            let html = '<div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">';
            
            // String memory
            const stringCount = Object.keys(redisStore.strings).length;
            html += `
                <div class="bg-red-900 p-3 rounded memory-cell">
                    <div class="text-red-300 font-bold">Strings</div>
                    <div class="text-2xl">${stringCount}</div>
                    <div class="text-xs text-red-400">${(Object.values(redisStore.strings).reduce((sum, v) => sum + String(v).length, 0) + Object.keys(redisStore.strings).reduce((sum, k) => sum + k.length, 0))} bytes</div>
                </div>
            `;
            
            // List memory
            const listCount = Object.keys(redisStore.lists).length;
            html += `
                <div class="bg-blue-900 p-3 rounded memory-cell">
                    <div class="text-blue-300 font-bold">Lists</div>
                    <div class="text-2xl">${listCount}</div>
                    <div class="text-xs text-blue-400">${Object.entries(redisStore.lists).reduce((sum, [k, v]) => sum + k.length + v.reduce((s, item) => s + String(item).length, 0), 0)} bytes</div>
                </div>
            `;
            
            // Set memory
            const setCount = Object.keys(redisStore.sets).length;
            html += `
                <div class="bg-green-900 p-3 rounded memory-cell">
                    <div class="text-green-300 font-bold">Sets</div>
                    <div class="text-2xl">${setCount}</div>
                    <div class="text-xs text-green-400">${Object.entries(redisStore.sets).reduce((sum, [k, v]) => sum + k.length + Array.from(v).reduce((s, item) => s + String(item).length, 0), 0)} bytes</div>
                </div>
            `;
            
            // Hash memory
            const hashCount = Object.keys(redisStore.hashes).length;
            html += `
                <div class="bg-purple-900 p-3 rounded memory-cell">
                    <div class="text-purple-300 font-bold">Hashes</div>
                    <div class="text-2xl">${hashCount}</div>
                    <div class="text-xs text-purple-400">${Object.entries(redisStore.hashes).reduce((sum, [k, v]) => sum + k.length + Object.entries(v).reduce((s, [f, val]) => s + f.length + String(val).length, 0), 0)} bytes</div>
                </div>
            `;
            
            html += '</div>';
            
            // Memory allocation visualization
            html += `<div class="mt-4">
                <div class="text-sm text-gray-400 mb-2">Memory Allocation</div>
                <div class="bg-gray-700 rounded-full h-4 overflow-hidden flex">
                    <div class="bg-red-500 h-full" style="width: ${(stringCount / totalKeys) * 100}%"></div>
                    <div class="bg-blue-500 h-full" style="width: ${(listCount / totalKeys) * 100}%"></div>
                    <div class="bg-green-500 h-full" style="width: ${(setCount / totalKeys) * 100}%"></div>
                    <div class="bg-purple-500 h-full" style="width: ${(hashCount / totalKeys) * 100}%"></div>
                </div>
            </div>`;
            
            container.innerHTML = html;
        }

        // Command History Functions
        function addToHistory(command) {
            commandHistory.unshift(command);
            if (commandHistory.length > 50) {
                commandHistory.pop();
            }
            historyIndex = -1;
            updateHistoryButtons();
        }

        function navigateHistory(direction) {
            if (commandHistory.length === 0) return;
            
            if (direction === 'up') {
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                }
            } else {
                if (historyIndex > 0) {
                    historyIndex--;
                } else if (historyIndex === 0) {
                    historyIndex = -1;
                    document.getElementById('commandInput').value = '';
                    updateHistoryButtons();
                    return;
                }
            }
            
            document.getElementById('commandInput').value = commandHistory[historyIndex];
            updateHistoryButtons();
        }

        function updateHistoryButtons() {
            const prevBtn = document.getElementById('historyPrev');
            const nextBtn = document.getElementById('historyNext');
            const counter = document.getElementById('commandCounter');
            
            prevBtn.disabled = commandHistory.length === 0 || historyIndex >= commandHistory.length - 1;
            nextBtn.disabled = commandHistory.length === 0 || historyIndex <= 0;
            
            counter.textContent = `History: ${commandHistory.length} commands${historyIndex >= 0 ? ` (${historyIndex + 1}/${commandHistory.length})` : ''}`;
        }

        // Autocomplete Functions
        function setupAutocomplete() {
            const input = document.getElementById('commandInput');
            const autocompleteList = document.getElementById('autocompleteList');
            
            input.addEventListener('input', function() {
                const val = this.value;
                closeAllLists();
                if (!val) return false;
                
                const matches = [];
                for (const cmd in COMMAND_SPECS) {
                    if (cmd.startsWith(val.toUpperCase())) {
                        matches.push(cmd);
                    }
                }
                
                // Also match by purpose
                for (const cmd in COMMAND_SPECS) {
                    if (COMMAND_SPECS[cmd].purpose.toLowerCase().includes(val.toLowerCase()) && 
                        !matches.includes(cmd)) {
                        matches.push(cmd);
                    }
                }
                
                if (matches.length > 0) {
                    autocompleteList.innerHTML = '';
                    autocompleteList.classList.remove('hidden');
                    
                    matches.slice(0, 8).forEach(cmd => {
                        const item = document.createElement('div');
                        item.innerHTML = `<strong>${cmd}</strong> - ${COMMAND_SPECS[cmd].purpose}`;
                        item.addEventListener('click', function() {
                            input.value = cmd;
                            closeAllLists();
                        });
                        autocompleteList.appendChild(item);
                    });
                }
            });
            
            input.addEventListener('keydown', function(e) {
                const items = autocompleteList.getElementsByTagName('div');
                if (items.length === 0) return;
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    currentFocus = (currentFocus + 1) % items.length;
                    addActive(items);
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    currentFocus = (currentFocus - 1 + items.length) % items.length;
                    addActive(items);
                } else if (e.key === 'Enter' && currentFocus > -1) {
                    e.preventDefault();
                    items[currentFocus].click();
                }
            });
            
            let currentFocus = -1;
            
            function addActive(items) {
                removeActive(items);
                if (currentFocus >= items.length) currentFocus = 0;
                if (currentFocus < 0) currentFocus = items.length - 1;
                items[currentFocus].classList.add('autocomplete-active');
            }
            
            function removeActive(items) {
                for (let i = 0; i < items.length; i++) {
                    items[i].classList.remove('autocomplete-active');
                }
            }
            
            function closeAllLists() {
                autocompleteList.classList.add('hidden');
                currentFocus = -1;
            }
            
            document.addEventListener('click', function(e) {
                closeAllLists(e.target);
            });
        }

        // Data Export/Import Functions
        function exportData() {
            const data = {
                redisStore: {
                    strings: redisStore.strings,
                    lists: redisStore.lists,
                    sets: Object.fromEntries(Object.entries(redisStore.sets).map(([k, v]) => [k, Array.from(v)])),
                    hashes: redisStore.hashes,
                    zsets: redisStore.zsets
                },
                ttlStore: ttlStore,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `redis-playground-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addOutput('Data exported successfully', 'text-green-400');
        }

        function importData(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validate structure
                    if (!data.redisStore || !data.redisStore.strings) {
                        throw new Error('Invalid data format');
                    }
                    
                    // Import data
                    redisStore.strings = data.redisStore.strings || {};
                    redisStore.lists = data.redisStore.lists || {};
                    redisStore.hashes = data.redisStore.hashes || {};
                    redisStore.zsets = data.redisStore.zsets || {};
                    
                    // Convert arrays back to Sets
                    redisStore.sets = {};
                    if (data.redisStore.sets) {
                        Object.entries(data.redisStore.sets).forEach(([k, v]) => {
                            redisStore.sets[k] = new Set(v);
                        });
                    }
                    
                    ttlStore = data.ttlStore || {};
                    
                    renderAll();
                    updateMemoryDisplay();
                    addOutput('Data imported successfully', 'text-green-400');
                } catch (error) {
                    addOutput(`Import failed: ${error.message}`, 'text-red-400');
                }
            };
            reader.readAsText(file);
        }

        // Pub/Sub Functions
        function renderPubSub() {
            const channelsList = document.getElementById('channelsList');
            const channels = Object.keys(pubSubStore.channels);
            
            if (channels.length === 0) {
                channelsList.innerHTML = '<div class="text-gray-500 text-center py-4">No active channels. Use SUBSCRIBE to create channels</div>';
                return;
            }
            
            channelsList.innerHTML = channels.map(channel => `
                <div class="bg-gray-700 rounded p-3">
                    <div class="flex justify-between items-center">
                        <div class="font-mono text-pink-300">${escapeHtml(channel)}</div>
                        <div class="text-xs text-gray-400">${pubSubStore.channels[channel].length} subscribers</div>
                    </div>
                    <div class="mt-2 text-xs text-gray-400">
                        Last message: ${pubSubStore.channels[channel].lastMessage || 'None'}
                    </div>
                </div>
            `).join('');
        }

        function addMessageToLog(channel, message) {
            const log = document.getElementById('messageLog');
            const entry = document.createElement('div');
            entry.className = 'text-gray-300 fade-in';
            entry.innerHTML = `<span class="text-pink-400">[${escapeHtml(channel)}]</span> ${escapeHtml(message)}`;
            log.appendChild(entry);
            
            // Keep only last 20 messages
            while (log.children.length > 20) {
                log.removeChild(log.firstChild);
            }
            
            log.scrollTop = log.scrollHeight;
        }

        // Enhanced executeCommand with loading states and connection animation
        async function executeCommand(input) {
            if (isProcessing) return;
            
            isProcessing = true;
            const executeBtn = document.getElementById('executeBtn');
            const spinner = document.getElementById('executeSpinner');
            
            executeBtn.disabled = true;
            spinner.classList.remove('hidden');
            
            try {
                showConnectionAnimation();
                
                // Simulate network delay
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // Original command execution logic
                let result = '';
                const { command, args } = parseCommand(input);
                if (!command) return;
                
                // Add Pub/Sub commands
                switch (command) {
                    case 'SUBSCRIBE': {
                        if (args.length < 1) throw new Error('SUBSCRIBE requires at least one channel');
                        args.forEach(channel => {
                            if (!pubSubStore.channels[channel]) {
                                pubSubStore.channels[channel] = [];
                            }
                            pubSubStore.channels[channel].push('client-1'); // Simple client ID
                        });
                        result = `Subscribed to ${args.join(', ')}`;
                        renderPubSub();
                        break;
                    }
                    case 'PUBLISH': {
                        if (args.length < 2) throw new Error('PUBLISH requires channel and message');
                        const [channel, ...messageParts] = args;
                        const message = messageParts.join(' ');
                        
                        if (!pubSubStore.channels[channel]) {
                            result = '(integer) 0';
                        } else {
                            pubSubStore.channels[channel].lastMessage = message;
                            addMessageToLog(channel, message);
                            result = `(integer) ${pubSubStore.channels[channel].length}`;
                            renderPubSub();
                        }
                        break;
                    }
                    case 'UNSUBSCRIBE': {
                        if (args.length === 0) {
                            // Unsubscribe from all
                            Object.keys(pubSubStore.channels).forEach(channel => {
                                pubSubStore.channels[channel] = pubSubStore.channels[channel].filter(client => client !== 'client-1');
                                if (pubSubStore.channels[channel].length === 0) {
                                    delete pubSubStore.channels[channel];
                                }
                            });
                            result = 'Unsubscribed from all channels';
                        } else {
                            args.forEach(channel => {
                                if (pubSubStore.channels[channel]) {
                                    pubSubStore.channels[channel] = pubSubStore.channels[channel].filter(client => client !== 'client-1');
                                    if (pubSubStore.channels[channel].length === 0) {
                                        delete pubSubStore.channels[channel];
                                    }
                                }
                            });
                            result = `Unsubscribed from ${args.join(', ')}`;
                        }
                        renderPubSub();
                        break;
                    }
                    // ... rest of existing command cases ...
                    default:
                        // Use the existing command execution logic
                        // This would be the original switch cases from your code
                        // For brevity, I'm showing only the new Pub/Sub commands
                        break;
                }
                
                addOutput(`redis> ${input}`, 'text-green-400');
                if (Array.isArray(result)) {
                    result.forEach(line => addOutput(line, 'text-gray-300'));
                } else if (typeof result === 'string' && result.includes('\n')) {
                    result.split('\n').forEach(line => addOutput(line, 'text-gray-300'));
                } else if (result !== undefined && result !== null && result !== '') {
                    addOutput(result, 'text-gray-300');
                }
                
                addToHistory(input);
                updateMemoryDisplay();
                updateOpsCounter();
                renderMemoryStructure();
                
                if (aofEnabled) { logToAOF(input); }
                if (rdbEnabled && Math.random() < 0.3) { triggerSnapshot(); }
                
            } catch (error) {
                addOutput(`redis> ${input}`, 'text-red-400');
                addOutput(`(error) ${error.message}`, 'text-red-400');
                
                // Show contextual help
                try {
                    const parsed = parseCommand(input);
                    if (parsed.command) {
                        showCommandHelp(parsed.command);
                    }
                } catch (_) {
                    // ignore parse errors
                }
            } finally {
                isProcessing = false;
                executeBtn.disabled = false;
                spinner.classList.add('hidden');
            }
        }

        // Initialize all new features
        function initializeEnhancedFeatures() {
            setupAutocomplete();
            updateHistoryButtons();
            
            // Export/Import event listeners
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importBtn').addEventListener('click', () => {
                document.getElementById('importFile').click();
            });
            document.getElementById('importFile').addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    importData(e.target.files[0]);
                    e.target.value = ''; // Reset file input
                }
            });
            
            // Pub/Sub event listeners
            document.getElementById('publishBtn').addEventListener('click', () => {
                const channel = document.getElementById('pubChannel').value;
                const message = document.getElementById('pubMessage').value;
                if (channel && message) {
                    executeCommand(`PUBLISH ${channel} ${message}`);
                    document.getElementById('pubMessage').value = '';
                }
            });
            
            // Command history event listeners
            document.getElementById('historyPrev').addEventListener('click', () => navigateHistory('up'));
            document.getElementById('historyNext').addEventListener('click', () => navigateHistory('down'));
            
            // Keyboard shortcuts for history
            document.getElementById('commandInput').addEventListener('keydown', (e) => {
                if (e.key === 'ArrowUp' && (e.ctrlKey || e.metaKey)) {
                    e.preventDefault();
                    navigateHistory('up');
                } else if (e.key === 'ArrowDown' && (e.ctrlKey || e.metaKey)) {
                    e.preventDefault();
                    navigateHistory('down');
                }
            });
        }

        // Update the existing initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Existing initialization
            renderAll();
            updateMemoryDisplay();
            
            // New enhanced features
            initializeEnhancedFeatures();
        });

        // Make sure to update renderAll to include the new visualizations
        function renderAll() {
            renderStrings();
            renderLists();
            renderSets();
            renderHashes();
            renderZsets();
            renderPubSub();
            renderMemoryStructure();
        }

        // ... (rest of your existing functions like keyExistsAnywhere, removeKeyFromAllStructures, etc.) ...
    </script>
</body>
</html>
